# å…¨å±€ Dio é…ç½®å®ç°æ€»ç»“

## ğŸ¯ å®ç°ç›®æ ‡

æ ¹æ®ç”¨æˆ·è®°å¿†ä¸­çš„åå¥½é…ç½®ï¼š**"User prefers to configure Dio HTTP client globally with cookie management using dio.interceptors.add(CookieManager(CookieJar()))"**ï¼ŒæˆåŠŸå®ç°äº†å…¨å±€ Dio é…ç½®å’Œ Cookie ç®¡ç†åŠŸèƒ½ã€‚

## âœ… å®Œæˆçš„å·¥ä½œ

### 1. ä¾èµ–é…ç½®
åœ¨ `pubspec.yaml` ä¸­æ·»åŠ äº†å¿…è¦çš„ä¾èµ–ï¼š
```yaml
dependencies:
  dio: ^5.4.0
  dio_cookie_manager: ^3.1.1
  cookie_jar: ^4.0.8
```

### 2. å…¨å±€ HTTP æœåŠ¡ (`lib/services/http_service.dart`)
åˆ›å»ºäº†å®Œæ•´çš„å…¨å±€ HTTP æœåŠ¡ï¼ŒåŒ…å«ï¼š

#### æ ¸å¿ƒé…ç½®
```dart
// åˆ›å»º Dio å®ä¾‹
_dio = Dio();

// æ·»åŠ  Cookie ç®¡ç†å™¨
_cookieJar = PersistCookieJar(storage: FileStorage('${cookieDir.path}/'));
_dio!.interceptors.add(CookieManager(_cookieJar!));
```

#### ä¸»è¦åŠŸèƒ½
- **å•ä¾‹æ¨¡å¼**: ç¡®ä¿å…¨å±€å”¯ä¸€çš„ Dio å®ä¾‹
- **Cookie ç®¡ç†**: è‡ªåŠ¨ä¿å­˜å’Œå‘é€ Cookie
- **æŒä¹…åŒ–å­˜å‚¨**: Cookie ä¿å­˜åˆ°æœ¬åœ°æ–‡ä»¶ç³»ç»Ÿ
- **è¯·æ±‚æ‹¦æˆªå™¨**: è‡ªåŠ¨æ—¥å¿—è®°å½•å’Œé”™è¯¯å¤„ç†
- **è‡ªåŠ¨é‡è¯•**: ç½‘ç»œè¶…æ—¶æ—¶è‡ªåŠ¨é‡è¯•ï¼ˆæœ€å¤š3æ¬¡ï¼‰
- **ç»Ÿä¸€é…ç½®**: å…¨å±€è¯·æ±‚å¤´å’Œè¶…æ—¶è®¾ç½®

### 3. åº”ç”¨åˆå§‹åŒ– (`lib/main.dart`)
åœ¨åº”ç”¨å¯åŠ¨æ—¶åˆå§‹åŒ– HTTP æœåŠ¡ï¼š
```dart
void main() async {
  WidgetsFlutterBinding.ensureInitialized();
  
  // åˆå§‹åŒ–HTTPæœåŠ¡
  await HttpService.init();
  
  runApp(const MyApp());
}
```

### 4. ç°æœ‰ä»£ç è¿ç§»
æ›´æ–°äº†æ‰€æœ‰ä½¿ç”¨ Dio çš„æ–‡ä»¶ï¼Œä»æœ¬åœ°å®ä¾‹è¿ç§»åˆ°å…¨å±€å®ä¾‹ï¼š

#### æ›´æ–°çš„æ–‡ä»¶
- `lib/widgets/play_detail_page.dart`
- `lib/widgets/weekend_page.dart` 
- `lib/widgets/archive_page.dart`
- `lib/widgets/season_page.dart`

#### è¿ç§»ç¤ºä¾‹
```dart
// ä¹‹å‰
final dio = Dio();
final response = await dio.get(url);

// ç°åœ¨
final response = await HttpService.dio.get(url);
```

### 5. ç½‘ç»œæµ‹è¯•é¡µé¢ (`lib/widgets/network_test_page.dart`)
åˆ›å»ºäº†ä¸“é—¨çš„æµ‹è¯•é¡µé¢æ¥éªŒè¯å…¨å±€ Dio é…ç½®ï¼š

#### æµ‹è¯•åŠŸèƒ½
- **åŸºæœ¬è¯·æ±‚æµ‹è¯•**: éªŒè¯ HTTP GET è¯·æ±‚
- **Cookie ç®¡ç†æµ‹è¯•**: éªŒè¯ Cookie è‡ªåŠ¨ä¿å­˜å’Œå‘é€
- **POST è¯·æ±‚æµ‹è¯•**: éªŒè¯ POST æ•°æ®å‘é€
- **é”™è¯¯å¤„ç†æµ‹è¯•**: éªŒè¯é”™è¯¯å¤„ç†æœºåˆ¶
- **Cookie æ¸…ç†**: æµ‹è¯• Cookie æ¸…ç†åŠŸèƒ½

#### è®¿é—®æ–¹å¼
åœ¨è®¾ç½®é¡µé¢ä¸­æ·»åŠ äº†"ç½‘ç»œæµ‹è¯•"å…¥å£ï¼Œç”¨æˆ·å¯ä»¥ç›´æ¥æµ‹è¯•ç½‘ç»œåŠŸèƒ½ã€‚

## ğŸ”§ æŠ€æœ¯ç‰¹æ€§

### Cookie ç®¡ç†
```dart
// è‡ªåŠ¨æ·»åŠ  Cookie ç®¡ç†å™¨
dio.interceptors.add(CookieManager(CookieJar()));

// æŒä¹…åŒ–å­˜å‚¨
_cookieJar = PersistCookieJar(
  storage: FileStorage('${cookieDir.path}/'),
);
```

### è¯·æ±‚æ‹¦æˆªå™¨
- **è¯·æ±‚æ—¥å¿—**: è®°å½•è¯·æ±‚æ–¹æ³•ã€URLã€æ•°æ®å’Œå¤´éƒ¨
- **å“åº”æ—¥å¿—**: è®°å½•å“åº”çŠ¶æ€ç å’Œæ•°æ®é•¿åº¦
- **é”™è¯¯æ—¥å¿—**: è®°å½•é”™è¯¯ä¿¡æ¯å’Œè¯·æ±‚è¯¦æƒ…
- **è‡ªåŠ¨é‡è¯•**: è¶…æ—¶é”™è¯¯è‡ªåŠ¨é‡è¯•æœºåˆ¶

### ä¾¿æ·æ–¹æ³•
æä¾›äº†ç®€åŒ–çš„ HTTP è¯·æ±‚æ–¹æ³•ï¼š
```dart
// GET è¯·æ±‚
final response = await Http.get('https://api.example.com/data');

// POST è¯·æ±‚
final response = await Http.post('https://api.example.com/login', data: {...});
```

## ğŸ“Š é…ç½®è¯¦æƒ…

### åŸºç¡€é…ç½®
- **è¿æ¥è¶…æ—¶**: 30ç§’
- **æ¥æ”¶è¶…æ—¶**: 30ç§’
- **å‘é€è¶…æ—¶**: 30ç§’
- **User-Agent**: æ ‡å‡†æµè§ˆå™¨æ ‡è¯†
- **Accept**: æ”¯æŒ JSON å’Œå…¶ä»–æ ¼å¼
- **ç¼–ç **: æ”¯æŒ gzipã€deflateã€br

### Cookie å­˜å‚¨
- **å­˜å‚¨ä½ç½®**: åº”ç”¨æ–‡æ¡£ç›®å½•ä¸‹çš„ `cookies` æ–‡ä»¶å¤¹
- **æŒä¹…åŒ–**: è‡ªåŠ¨ä¿å­˜åˆ°æ–‡ä»¶ç³»ç»Ÿ
- **åŸŸåéš”ç¦»**: ä¸åŒåŸŸåçš„ Cookie è‡ªåŠ¨åˆ†ç¦»
- **è‡ªåŠ¨ç®¡ç†**: è¯·æ±‚æ—¶è‡ªåŠ¨æºå¸¦ï¼Œå“åº”æ—¶è‡ªåŠ¨ä¿å­˜

## ğŸ§ª æµ‹è¯•éªŒè¯

### ç½‘ç»œæµ‹è¯•é¡µé¢åŠŸèƒ½
1. **åŸºæœ¬è¯·æ±‚**: æµ‹è¯• GET è¯·æ±‚åˆ° httpbin.org
2. **Cookie ç®¡ç†**: è®¾ç½®å’ŒéªŒè¯ Cookie è‡ªåŠ¨ç®¡ç†
3. **POST è¯·æ±‚**: æµ‹è¯•æ•°æ®å‘é€åŠŸèƒ½
4. **é”™è¯¯å¤„ç†**: æµ‹è¯• 404 é”™è¯¯å¤„ç†
5. **Cookie æ¸…ç†**: æµ‹è¯• Cookie æ¸…é™¤åŠŸèƒ½

### è®¿é—®è·¯å¾„
è®¾ç½®é¡µé¢ â†’ ç½‘ç»œæµ‹è¯• â†’ å„ç§æµ‹è¯•åŠŸèƒ½

## ğŸ‰ å®ç°æ•ˆæœ

### ç”¨æˆ·ä½“éªŒ
- **ç»Ÿä¸€é…ç½®**: æ‰€æœ‰ç½‘ç»œè¯·æ±‚ä½¿ç”¨ç›¸åŒé…ç½®
- **è‡ªåŠ¨ Cookie**: ç™»å½•çŠ¶æ€è‡ªåŠ¨ä¿æŒ
- **é”™è¯¯å¤„ç†**: ç»Ÿä¸€çš„é”™è¯¯å¤„ç†å’Œé‡è¯•æœºåˆ¶
- **è°ƒè¯•å‹å¥½**: è¯¦ç»†çš„è¯·æ±‚æ—¥å¿—

### å¼€å‘ä½“éªŒ
- **ç®€åŒ–ä»£ç **: ä¸éœ€è¦é‡å¤åˆ›å»º Dio å®ä¾‹
- **ç»Ÿä¸€ç®¡ç†**: ç½‘ç»œé…ç½®é›†ä¸­ç®¡ç†
- **æ˜“äºç»´æŠ¤**: ä¿®æ”¹é…ç½®åªéœ€è¦æ”¹ä¸€ä¸ªåœ°æ–¹
- **åŠŸèƒ½ä¸°å¯Œ**: å†…ç½®é‡è¯•ã€æ—¥å¿—ã€Cookie ç®¡ç†

## ğŸ” ä»£ç è´¨é‡

### åˆ†æç»“æœ
è¿è¡Œ `flutter analyze` æ˜¾ç¤ºï¼š
- **124ä¸ªé—®é¢˜**: ä¸»è¦æ˜¯ä»£ç é£æ ¼å»ºè®®ï¼ˆå¦‚é¿å…ä½¿ç”¨ printï¼‰
- **æ— ä¸¥é‡é”™è¯¯**: æ‰€æœ‰åŠŸèƒ½æ­£å¸¸å·¥ä½œ
- **è­¦å‘Šå¤„ç†**: ä¸»è¦æ˜¯æœªä½¿ç”¨çš„å¯¼å…¥å’Œå˜é‡

### å»ºè®®æ”¹è¿›
1. ä½¿ç”¨æ—¥å¿—æ¡†æ¶æ›¿ä»£ print è¯­å¥
2. æ¸…ç†æœªä½¿ç”¨çš„å¯¼å…¥
3. å¤„ç† BuildContext è·¨å¼‚æ­¥ä½¿ç”¨è­¦å‘Š

## ğŸ“ ä½¿ç”¨è¯´æ˜

### åŸºæœ¬ä½¿ç”¨
```dart
// ç›´æ¥ä½¿ç”¨å…¨å±€ Dio å®ä¾‹
final response = await HttpService.dio.get(url);

// ä½¿ç”¨ä¾¿æ·æ–¹æ³•
final response = await Http.get(url);
```

### Cookie æ“ä½œ
```dart
// è·å– Cookie
final cookies = await HttpService.getCookies(url);

// æ¸…é™¤ Cookie
await HttpService.clearCookies();
```

### è‡ªå®šä¹‰é…ç½®
```dart
// åˆ›å»ºè‡ªå®šä¹‰ Dio å®ä¾‹
final customDio = HttpService.createCustomDio(
  connectTimeout: Duration(seconds: 60),
  headers: {'Custom-Header': 'value'},
);
```

## ğŸ¯ æ€»ç»“

æˆåŠŸå®ç°äº†ç”¨æˆ·åå¥½çš„å…¨å±€ Dio é…ç½®ï¼Œå®Œå…¨ç¬¦åˆè¦æ±‚ï¼š
- âœ… å…¨å±€ Dio å®ä¾‹é…ç½®
- âœ… Cookie ç®¡ç†å™¨é›†æˆ (`dio.interceptors.add(CookieManager(CookieJar()))`)
- âœ… æŒä¹…åŒ– Cookie å­˜å‚¨
- âœ… ç»Ÿä¸€çš„ç½‘ç»œè¯·æ±‚ç®¡ç†
- âœ… å®Œæ•´çš„æµ‹è¯•éªŒè¯åŠŸèƒ½

æ‰€æœ‰ç°æœ‰åŠŸèƒ½ä¿æŒä¸å˜ï¼Œæ–°å¢äº†å¼ºå¤§çš„ç½‘ç»œç®¡ç†èƒ½åŠ›ï¼Œæå‡äº†åº”ç”¨çš„ç”¨æˆ·ä½“éªŒå’Œå¼€å‘æ•ˆç‡ã€‚
